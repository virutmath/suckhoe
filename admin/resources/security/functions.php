<?php
function checkLogged($a=""){checkloged();$a=$a?$a:'../../resources/php/deny.php';$b=getValue('userlogin','str','SESSION','');$c=getValue('password','str','SESSION','');$d=getValue("user_id","int","SESSION");$e=getValue("isAdmin","int","SESSION",0);$f=new db_query("SELECT adm_id 
								 FROM admin_users
								 WHERE adm_loginname = '".$b."' AND adm_password = '".$c."'");if(mysqli_num_rows($f->result)>0){$g=mysqli_fetch_array($f->result);$h=$g["adm_id"];$f->close();unset($f);if($h!=$d){redirect($a);}}else{redirect($a);}}function checkLogin($b,$c){$b=replaceMQ($b);$c=replaceMQ($c);$f=new db_query("SELECT adm_id 
							 FROM admin_users
							 WHERE adm_loginname = '".$b."' AND adm_password = '".md5($c)."'");if(mysqli_num_rows($f->result)>0){$g=mysqli_fetch_array($f->result);$h=$g["adm_id"];$f->close();unset($f);return $h;}else{$f->close();unset($f);return 0;}}function checkAccessModule($i){$e=getValue("isAdmin","int","SESSION",0);if($e){return true;}$j=new db_query('SELECT adu_admin_id FROM admin_users_right WHERE adu_admin_module_id = '.$i);if(mysqli_num_rows($j->result)){unset($j);return true;}else{redirect('../../resources/php/deny.php');}}function checkloged(){$k=$_SERVER["SERVER_NAME"];$k=str_replace("www.","",$k);$l=new db_query("SELECT * FROM kdims WHERE kdm_domain = '".md5($k)."' LIMIT 1");if($m=mysqli_fetch_assoc($l->result)){$n=str_debase($m["kdm_key"]);$o=json_decode($n,true);if($o!=null){if(md5($m["kdm_key"]."|".$o["pass"])!=$m["kdm_hash"]){notifydie("Dang ky chua dung key");}else{return $o;}}else{notifydie("Dang ky chua dung key");}}else{notifydie("Chua dang ky domain");}}function checkPermission($p){global $module_id;$d=getValue("user_id","int","SESSION");$e=getValue("isAdmin","int","SESSION",0);if($e){return true;}$j=new db_query('SELECT adu_admin_'.$p.'
						FROM admin_users_right
						WHERE adu_admin_id = '.$d.' AND adu_admin_module_id = '.$module_id);$q=mysqli_fetch_assoc($j->result);if($q['adu_admin_'.$p]==1){return true;}else{die('<div style="margin: 25px auto;padding: 10px;text-align: center"><h3>B&#7841;n không có quy&#7873;n truy c&#7853;p ch&#7913;c n&#259;ng này</h3></div>');}}function call_module_file($r,$p){if(file_exists('../'.$r.'/'.$p.'.php')){return'../'.$r.'/'.$p.'.php';}else{return '../../core/'.$r.'/'.$p.'.php';}}?>