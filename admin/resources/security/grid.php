<?php
class dataGrid{var $stt=0; private $field_id; private $arrayField=array(); private $arraySearch=array(); private $arrayAddSearch=array(); private $arraySort=array(); private $arrayLabel=array(); private $arrayType=array(); private $arrayExtra=array(); private $total_row=0; private $page_size=30; public function __construct($field_id,$page_size=30){$this->field_id=$field_id;$this->page_size=$page_size;}function add($field_name,$label,$type='string',$search=0,$sort=0,$extra=''){$this->arrayField[$this->stt]=$field_name;$this->arrayLabel[$this->stt]=$label;$this->arrayType[$this->stt]=$type;$this->arrayExtra[$this->stt]=$extra;if($search)$this->arraySearch[$this->stt]=$field_name;if($sort)$this->arraySort[$this->stt]=$field_name;$this->stt++;}function addSearch($name,$field,$type,$value='',$default=""){$str='';$value=$value?$value:$default;$str.='&nbsp;'.$name.'&nbsp;';switch($type){case "array":$str.='<select name="'.$field.'" id="'.$field.'" class="textbox form-control">';foreach($value as $id=>$text){$str.='<option value="'.$id.'" '.(($default==$id)?'selected':'').'>'.$text.'</option>';}$str.='</select>';break;case "date":$value=$value?$value:($default?$default:date('d/m/Y'));$value=getValue($field,"str","GET",$value);$str.='<input type="text" name="'.$field.'" id="'.$field.'" value="'.$value.'" datepick-element="1" class="form-control">';break;case "text":$value=getValue($field,"str","GET",translate_text("Enter keyword"));$str.='<input type="text" class="form-control" name="'.$field.'" id="'.$field.'" value="'.$value.'">';break;}$this->arrayAddSearch[]=$str;}function showHeader($total_row,$extra='',$table_extra=''){$this->total_row=$total_row;$header='<div class="grid_header"><form name="grid_search" class="form-inline" action="'.$_SERVER['SCRIPT_NAME'].'" method="get">';$header.=form_hidden('search',1);foreach($this->arraySearch as $key=>$value){$fieldname=$this->arrayField[$key];$strExtra=isset($this->arrayExtra[$key])?$this->arrayExtra[$key]:'';switch($this->arrayType[$key]){case 'string':$queryValue=getValue($fieldname,'str','GET','');$header.='<input type="text" class="form-control" name="'.$value.'" placeholder="'.$this->arrayLabel[$key].'" value="'.$queryValue.'" '.$strExtra.' />&nbsp;';break;case 'array':global $$fieldname;$header.='<select name="'.$value.'" '.$strExtra.' class="form-control">';$header.='<option value="-1">'.$this->arrayLabel[$key].'</option>';$slValue=getValue($fieldname,'str','GET','');foreach($$fieldname as $k=>$v){$selected=($k==$slValue?'selected="selected"':'');$header.='<option value="'.$k.'" '.$selected.'>'.$v.'</option>';}$header.='</select>&nbsp;';break;}}foreach($this->arrayAddSearch as $value){$header.=$value;}$header.='<input type="submit" value="Tìm ki&#7871;m" class="btn btn-default"/>';$header.='</form></div>'.'<script type="text/javascript">$(document).ready(function(){Grid = new Grid();});</script>'.$extra;$header.=form_open_multipart('quickedit.php',array('name'=>'listing'),array('iQuick'=>'update'));$header.='<table class="table table-bordered table-hover " id="table-listing" '.$table_extra.'>';$header.='<thead><tr>';if(file_exists('quickedit.php')){$header.='<th>ID</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <th><input type="checkbox" id="check_all" class="check" onclick="Grid.checkall()"/></th>
                    <th><input type="image" src="../../resources/img/save.png" style="border:0px;height:16px;cursor:pointer;" onclick="document.listing.submit()"/></th>';}else{$header.='<th>STT</th>';}foreach($this->arrayLabel as $key=>$label){$c=isset($this->arraySort[$key])?$this->urlsort($this->arrayField[$key]):'';$header.='<th><strong>'.$label.'</strong> '.$c.'</th>';}$header.='</tr></thead>';return $header;}function start_tr($i,$record_id,$add_html=""){$page=getValue("page");if($page<1)$page=1;$str='<tbody><tr id="tr_'.$record_id.'">';$str.=$this->showId($i,$page);if(file_exists('quickedit.php')){$str.=$this->showCheck($i,$record_id);}return $str;}function end_tr(){$str='</tr></tbody>';return $str;} private function showId($i,$page){$str='<td width="15" class="center" ><span style="color:#142E62; font-weight:bold">'.($i+(($page-1)*$this->page_size)).'</span></td>';return $str;} private function showCheck($i,$record_id){$str='<td width="15" class="center"><input type="checkbox" class="check" name="record_id[]" id="record_'.$i.'" value="'.$record_id.'"></td>';$str.='<td width="15" class="center"><img src="../../resources/img/save.png" style="cursor:pointer;" onclick="document.getElementById(\'record_'.$i.'\').checked = true;document.listing.submit()"/></td>';return $str;}function showCheckbox($field,$value,$record_id){$input=form_checkbox($field,1,$value,'onclick="Grid.update_active(\''.$field.'\','.$record_id.')" id="'.$field.'_'.$record_id.'" ');$str='<td width="15" class="center">'.$input.'</td>';return $str;}function showEdit($record_id,$extra=''){return '<td width="10" class="center"><a href="edit.php?record_id='.$record_id.'"><i class="fa fa-pencil"></i></a></td>';}function showDelete($record_id,$extra=''){return '<td width="10" class="center"><a href="#" onclick="Grid.delete_one('.$record_id.');return false;"><i class="fa fa-trash-o"></i></a></td>';}function showFooter(){$cols=$this->stt+3;$footer='<tr class="footer"><td colspan="'.$cols.'">';if(file_exists('quickedit.php')){$footer.='&nbsp;<a href="#" onclick="Grid.delete_all('.$this->total_row.');return false;" style="float:left;margin-right:20px;">Delete all selected <i class="icon-remove icon-red"></i></a>';}$footer.='<span class="fl">&#272;ang hi&#7875;n th&#7883; '.$this->total_row.'/'.$this->total_record.' record</span>';$footer.=$this->generate_page();$footer.='</td></tr></table>';return $footer;}function sqlSearch(){$search=getValue("search","int","GET",0);$str='';if($search==1){foreach($this->arraySearch as $key=>$field){$keyword=getValue($field,"str","GET","");if($keyword==$this->arrayLabel[$key])$keyword="";$keyword=str_replace(" ","%",$keyword);$keyword=str_replace("\'","'",$keyword);$keyword=str_replace("'","''",$keyword);switch($this->arrayType[$key]){case "string":if(trim($keyword)!='')$str.=' AND '.$field.' LIKE "%'.$keyword.'%" ';break;case "array":if(intval($keyword)>-1)$str.=' AND '.$field.'='.intval($keyword).' ';break;}}}return $str;}function sqlSort(){$sort=getValue("sort","str","GET","");$field=getValue("sortname","str","GET","");$str='';if(in_array($field,$this->arraySort)&&($sort=="asc"||$sort=="desc")){$str=$field.' '.$sort.',';}return $str;}function urlsort($field){$str='';if(in_array($field,$this->arraySort)){$url=getURL(0,1,1,1,"sort|sortname");$sort=getValue("sort","str","GET","");$sortname=getValue("sortname","str","GET","");if($sortname!=$field)$sort="";switch($sort){case "asc":$url=$url.'&sort=desc';break;case "desc":$url=$url.'&sort=asc';break;default:$url=$url."&sort=asc";break;}$url=$url.'&sortname='.$field;$str='<a href = "'.$url.'" onclick="loadpage(this)"><i class="fa fa-sort-alpha-'.($sort=='desc'?'desc':'asc').'"></i></a>';}return $str;}function generate_page(){$str='<div class="fr show-all-page">';if($this->total_record>$this->page_size){$total_page=$this->total_record/$this->page_size;$page=getValue("page","int","GET",1);if($page<1)$page=1;$str.='<a href="'.getURL(0,1,1,1,"page").'&page=1"><i class="icon-fast-backward icon-red"></i></a>';if($page>1)$str.='<a href="'.getURL(0,1,1,1,"page").'&page='.($page-1).'" onclick="loadpage(this); return false;"><i class="icon-step-backward icon-red"></i></a>';$start=$page-5;if($start<1)$start=1;$end=$page+5;if($page<5)$end=$end+(5-$page);if($end>$total_page)$end=intval($total_page);if($end<$total_page)$end++;for($i=$start;$i<=$end;$i++){$str.='<a href="'.getURL(0,1,1,1,"page").'&page='.$i.'">'.(($i==$page)?'<span class="s">['.$i.']</span>':'<span>'.$i.'</span>').'</a>';}if($page<$total_page)$str.='<a href="'.getURL(0,1,1,1,"page").'&page='.($page+1).'"><i class="icon-step-forward icon-red"></i></a>';$str.='<a href="'.getURL(0,1,1,1,"page").'&page='.$total_page.'"><i class="icon-fast-forward icon-red"></i></a>';}$str.='</div>';return $str;}function limit($total_record){$this->total_record=$total_record;$page=getValue("page","int","GET",1);if($page<1)$page=1;$str="LIMIT ".($page-1)*$this->page_size.",".$this->page_size;return $str;}function getPictureThumb($filename,$field_name=''){$str='';if(!$field_name){$str.='<div style="width:80px;height:80px;margin:0 auto;padding-bottom:5px;"><img src="'.$filename.'" style="width:100%" alt="Không có &#7843;nh"/></div>';return $str;}}}?>